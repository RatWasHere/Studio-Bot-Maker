<html>
    <link rel="stylesheet" href="main.css">
    <meta charset="utf8">
    <div class="sidebar" id="sidebar">
        <br>
        <div class="sidebarbutton flexbox outlined" onclick="modcolor()">
            <div class="image colors noanims;" style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">Colors</div>
        </div>
        <div class="sidebarbutton flexbox" onclick="savePrj()">
            <div class="image save noanims;"style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">Save</div>
        </div>
        <div class="sidebarbutton flexbox outlined" onclick="exportProject()" >
            <div class="image export noanims;"style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">Export</div>
        </div>
        <div class="sidebarbutton flexbox outlined" onclick="sltPrj()" >
            <div class="image import noanims;"style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">Import</div>
        </div>
        <div class="sidebarbutton flexbox" onclick="ipcRenderer.send('runBot')" >
            <div class="image startbot noanims;"style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">Start Bot</div>
        </div>
        <div class="sidebarbutton flexbox outlined" onclick="settoken()" >
            <div class="image botsetup noanims;"style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">Bot Setup</div>
        </div>
        <div class="sidebarbutton flexbox outlined" onclick="require('electron').shell.openExternal('https:/\/discord.gg/wjXz7jGgCw')">
            <div class="image editAction noanims;"style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">Support Server</div>
        </div>

    </div>

    <div style="justify-content: center; width: 100%; align-content: center; margin-left: auto; margin-right: auto; align-items: center; justify-items: center;">
<div class="flexbox fbh">
    <div style="flex: none; overflow-x: auto; width: 48.3vw;">
        <div id="animationArea">
    <div class="actBarHalf actbartop" id="commandbar" style="z-index: 2;">
    </div>
    <div class="actbartoolbar flexbox actbarbottom" style="margin-bottom: 2vh; align-items: center; justify-content: center;">
        <div style="margin-right: auto; margin-left: 1vw;">
        <div class="barbuttontexta">Groups</div>
        </div> 
        <div style="margin-left: auto; margin-right: 1vw" class="flexbox" style="align-items: center; justify-content: center;">
            <div class="barbuttone borderrightz" onclick="lastType = 0; newObject();" style="width: 2.7vw; height: 3.5vh;">
                <div class="image add"></div>
            </div>
            <div class="barbuttone bordercenter" onclick="lastType = 0; moveUp();" style="margin-left: 0.12vw; margin-right: 0.12vw; width: 2.7vw; height: 3.5vh;">
                <div class="image actionUp"></div>
            </div>
        <div class="barbuttone borderleftz" onclick="lastType = 0; moveDown();" style="width: 2.7vw; height: 3.5vh;">
            <div class="image actionDown"></div>
        </div>
        </div>       </div>
    <div class="actBarHalf actbartop" id="actionbar">
    </div>
    <div class="actbartoolbar flexbox actbarbottom" style="align-items: center; justify-content: center;">
        <div style="margin-right: auto; margin-left: 1vw;">
        <div class="barbuttontexta" id="actionsOf">Actions of </div>
        </div> 
        
        <div style="margin-left: auto; margin-right: 1vw" class="flexbox" style="align-items: center; justify-content: center;">
            <div class="barbuttone borderrightz" onclick="lastType = 1; editAction(document.getElementById('Action' + lastAct));" style="width: 2.7vw; height: 3.5vh;">
                <div class="imagefull editAction"></div>
            </div>
            <div class="barbuttone bordercenter" onclick="lastType = 1; newObject();" style="width: 2.7vw; height: 3.5vh; margin-left: 0.12vw; margin-right: 0.12vw;">
                <div class="image add"></div>
            </div>
            <div class="barbuttone bordercenter" onclick="lastType = 1; moveUp();" style="margin-left: 0.12vw; margin-right: 0.12vw; width: 2.7vw; height: 3.5vh;">
                <div class="image actionUp"></div>
            </div>
        <div class="barbuttone borderleftz" onclick="lastType = 1; moveDown();" style="width: 2.7vw; height: 3.5vh;">
            <div class="image actionDown"></div>
        </div>
        </div>
    </div>
</div>

</div>
    <div id="edutor" class="fullsize">
        <div id="animationEditor" style="height: 100%;">
        <div class="tile borderbottomz" style="background: linear-gradient(0deg, #FFFFFF10, #FFFFFF15)">
        <div class="text clsr" style="margin-top: 0px;">Group Name</div>
        <input class="inputBar" style="width: 96%; border-radius: 9px; margin: auto;" contenteditable="true" id="Command_Name" onkeydown="elementContentChecker(this, {maxLength: 31, isCommandName: true})" onblur="updateName(this)">
    </div>
        <div class="tile bordertop" style="background: linear-gradient(0deg, #FFFFFF15, #FFFFFF10)">
        <div id="botData.commands[lastObj].actions" class="baction noanims" style="width: 90%; padding: 5px; margin-top: 0px; margin-bottom: 10px;">Using 0 Actions</div>
        <div class="flexbox" style="height: 5vh; justify-content: center; margin-bottom: 0.5vh;">
            <div id="rawData" class="barbuttond borderright" onclick="switchGroups()" style="width: 30%; padding-left: 0px; padding-right: 0px;"><div class="barbuttontexta" id="wedf">Type</div></div>
        <div id="rawData" class="barbuttond bordercenter" onclick="duplicate()" style="width: 30%; padding-left: 0px; padding-right: 0px;"><div class="barbuttontexta">Duplicate</div></div>
        <div id="rawData" class="barbuttond borderleft" onclick="commandOptions()" style="width: 30%; padding-left: 0px; padding-right: 0px;"><div class="barbuttontexta">Options</div></div>
    </div></div>
    
        <div class="sepbar"></div>
        <div class="tile" style="height: 50%; background-color: unset; background: linear-gradient(0deg, #FFFFFF15, #FFFFFF10)">

        <div class="tiled" id="tld">
            <div class="tiledbottom" id="status">✓ • No Issues Found</div>
            <br>
            <div class="flexbox" id="issues"></div>
            <br>
        </div>
        </div>
        <div class="barbuttone" onclick="modifyActElm()" style="margin-top: 2vh; width: 6vw;">
            <div class="barbuttontexta">Home</div>
        </div>
</div></div>
</div>

    </div>


<div class="bottombar" onclick="modifyBar()" id="bottombar">•••</div>
</div>
    <script>
        document.body.style.background =  'linear-gradient(45deg, #000814 0%,#1d1d1d 160%)'
    </script>
    <script src="./AppData/Kits/EditorBones.js"></script>
    <script src="./AppData/Kits/MiscScripts.js"></script>
    <script src="./AppData/Kits/ActionModules.js"></script>

    <script>
        document.body.style.padding = '1vw'
        document.body.style.paddingTop = '1vh'
        document.body.style.paddingBottom = '1.8vh'

        const interactionTools = require('./AppData/Toolkit/interactionTools.js')
const fese = require('fs')
try {
    fese.readFileSync(processPath + '\\AppData\\data.json', 'utf8')
} catch (err) {

    document.body.innerHTML = `<div class="flexbox" style="height: 50vh; margin-top: 24vh;">
    <div class="ring"></div>
    <div class="barbuttontexta">Hold on, Studio Bot Maker is downloading a few things!</div></div>`
    setTimeout(() => {
        location.reload()
    }, 10000)}

        let lastButton;
        let pinHTML;
      
    async function commandData() {
        let elmd = document.getElementById('commandData')
        elmd.style.animationName = 'expandFrom'
        elmd.style.animationDuration = '0.5s'
        elmd.style.height = '40%'
        elmd.style.maxHeight = '1000%'
        elmd.onclick = () => {}
        elmd.style.borderRadius = '22px'
        setTimeout(() => {
            for (let action in botData.commands[lastObj]) {
                elmd.innerHTML += `<div class="action"><div>${action}</div> - ${botData.commands[lastObj].action}</div>`
            }
        }, 500)
    }
      let ActionTile = document.getElementById('commandbar');
      let SWT = document.getElementById('switchTask')
      let CmdName = document.getElementById('Command_Name')

    let currentlyEditing = false;

    function updateName(mnt) {
        let type = 'event'
            if (botData.commands[lastObj].type == 'action') {
                console.log(botData.commands[lastObj])
                    switch(botData.commands[lastObj].trigger) {
                case 'slashCommand':
                    type = 'slsh'
                    break
                case 'textCommand':
                    type = 'txt'
                break
                case 'messageContent':
                    type = 'msg'
            }
        }
        if (type == 'txt' || type == 'msg') {
            let text = mnt.value
            let output = text.replaceAll('&nbsp;', "").replaceAll(" ", "")


            botData.commands[lastObj].name = output.trim()
            
        if (lastType == 0) {
            document.getElementById(`Group${lastObj}`).innerHTML = `<div id="name">${output.trim()}</div> <div style="opacity: 50%; margin-left: 7px;"> | ${Object.keys(botData.commands[lastObj].actions).length} Actions</div> <div class="deleteActionButton forceRounded" onclick="deleteObject(this)">✕</div>`
        }
        }
        if (type == 'event') {
            botData.commands[lastObj].name = mnt.value
            if (lastType == 0) {
            document.getElementById(`Group${lastObj}`).innerHTML = `<div id="name">${mnt.value}</div> <div style="opacity: 50%; margin-left: 7px;"> | ${Object.keys(botData.commands[lastObj].actions).length} Actions</div> <div class="deleteActionButton forceRounded" onclick="deleteObject(this)">✕</div>`
            }
        }
        if (type == 'slsh') {
            let text = mnt.value
            let output = text.replaceAll('&nbsp;', "").replaceAll(" ", "")
            botData.commands[lastObj].name = output.toLowerCase().trim()    
            if (lastType == 0) {
            document.getElementById(`Group${lastObj}`).innerHTML = `<div id="name">${output.toLowerCase().trim()}</div> <div style="opacity: 50%; margin-left: 7px;"> | ${Object.keys(botData.commands[lastObj].actions).length} Actions</div> <div class="deleteActionButton forceRounded" onclick="deleteObject(this)">✕</div>`
        }
        }



        fs.writeFileSync(processPath + '\\AppData\\data.json', JSON.stringify(botData, null, 2))
    }

        refreshGroups()
        setTimeout(() => {
            refreshActions()
        }, 500)
        highlight(document.getElementById('Group1'), true, true)
        try {
            ipcRenderer.send('finishLoad', {})
        } catch (err) {
            fs.writeFileSync('./errorlog.txt', err)
        }
        </script>
    </html>