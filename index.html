<html>
    <link rel="stylesheet" href="main.css">
    <meta charset="utf8">
    <div class="sidebar" style="display: none;">
        <div class="sidebartext">Dashboard</div>
        <div class="sidebarbutton flexbox outlined">
            <div class="image switchObjs noanims;" style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">
                Dashboard</div>
        </div>
        <div class="sidebarbutton flexbox" onclick="initSetup()" >
            <div class="image save noanims;"style="width: 2vw; height: 2vw; margin-left: 1vw;"></div>
            <div class="sidebartext">
                Setup</div>
        </div>
    </div>
    <div style="justify-content: center; width: 100%; align-content: center; margin-left: auto; margin-right: auto; align-items: center; justify-items: center;">
<div class="flexbox fbh">
    <div style="flex: none; overflow-x: auto; width: 48.3vw;">
        <div id="animationArea">
    <div class="actBarHalf actbartop" id="commandbar" style="z-index: 2;">

    </div>
    <div class="actbartoolbar flexbox actbarbottom" style="margin-bottom: 2vh; align-items: center; justify-content: center;">
        <div style="margin-right: auto; margin-left: 1vw;">
        <div class="barbuttontexta">Groups</div>
        </div> 
        
        <div style="margin-left: auto; margin-right: 1vw" class="flexbox" style="align-items: center; justify-content: center;">
            <div class="barbuttone borderrightz" onclick="lastType = 0; newObject();" style="width: 2.7vw; height: 3.5vh;">
                <div class="image add"></div>
            </div>
            <div class="barbuttone bordercenter" onclick="lastType = 0; moveUp();" style="margin-left: 0.12vw; margin-right: 0.12vw; width: 2.7vw; height: 3.5vh;">
                <div class="image actionUp"></div>
            </div>
        <div class="barbuttone borderleftz" onclick="lastType = 0; moveDown();" style="width: 2.7vw; height: 3.5vh;">
            <div class="image actionDown"></div>
        </div>
        </div>       </div>
    <div class="actBarHalf actbartop" id="actionbar">

    </div>
    
    <div class="actbartoolbar flexbox actbarbottom" style="align-items: center; justify-content: center;">
        <div style="margin-right: auto; margin-left: 1vw;">
        <div class="barbuttontexta" id="actionsOf">Actions of </div>
        </div> 
        
        <div style="margin-left: auto; margin-right: 1vw" class="flexbox" style="align-items: center; justify-content: center;">
            <div class="barbuttone borderrightz" onclick="lastType = 1; editAction(document.getElementById('Action' + lastAct));" style="width: 2.7vw; height: 3.5vh;">
                <div class="imagefull editAction"></div>
            </div>
            <div class="barbuttone bordercenter" onclick="lastType = 1; newObject();" style="width: 2.7vw; height: 3.5vh; margin-left: 0.12vw; margin-right: 0.12vw;">
                <div class="image add"></div>
            </div>
            <div class="barbuttone bordercenter" onclick="lastType = 1; moveUp();" style="margin-left: 0.12vw; margin-right: 0.12vw; width: 2.7vw; height: 3.5vh;">
                <div class="image actionUp"></div>
            </div>
        <div class="barbuttone borderleftz" onclick="lastType = 1; moveDown();" style="width: 2.7vw; height: 3.5vh;">
            <div class="image actionDown"></div>
        </div>
        </div>
    </div>
</div>

</div>
    <div id="edutor" class="fullsize">
        <div id="animationEditor" style="height: 100%;">
        <div class="tile borderbottomz" style="background: linear-gradient(0deg, #FFFFFF10, #FFFFFF15)">
        <div class="text clsr" style="margin-top: 0px;">Group Name</div>
        <div class="inputBar" style="width: 96%; border-radius: 9px; margin: auto;" contenteditable="true" id="Command_Name" onkeydown="elementContentChecker(this, {maxLength: 31, isCommandName: true})" onblur="updateName(this)"></div>
    </div>
        <div class="tile bordertop" style="background: linear-gradient(0deg, #FFFFFF15, #FFFFFF10)">
        <div id="commandActions" class="baction noanims" style="width: 90%; padding: 5px; margin-top: 0px; margin-bottom: 10px;">Using 0 Actions</div>
        <div class="flexbox" style="height: 5vh; justify-content: center; margin-bottom: 0.5vh;">
            <div id="rawData" class="barbuttond borderright" onclick="switchGroups()" style="width: 30%; padding-left: 0px; padding-right: 0px;"><div class="barbuttontexta" id="wedf">Type</div></div>
        <div id="rawData" class="barbuttond bordercenter" onclick="duplicate()" style="width: 30%; padding-left: 0px; padding-right: 0px;"><div class="barbuttontexta">Duplicate</div></div>
        <div id="rawData" class="barbuttond borderleft" onclick="commandOptions()" style="width: 30%; padding-left: 0px; padding-right: 0px;"><div class="barbuttontexta">Options</div></div>
    </div></div>
    
        <div class="sepbar"></div>
        <div class="tile" style="height: 50%; background-color: unset; background: linear-gradient(0deg, #FFFFFF15, #FFFFFF10)">

        <div class="tiled" id="tld">
            <div class="tiledbottom" id="status">✓ • No Issues Found</div>
            <br>
            <div class="flexbox" id="issues"></div>
            <br>
        </div>
        </div>
        <div class="barbuttone" onclick="modifyActElm()" style="margin-top: 2vh; width: 6vw;">
            <div class="barbuttontexta">Home</div>
        </div>
</div></div>
</div>

    </div>


<div class="bottombar" onclick="modifyBar()" id="bottombar">•••</div>
</div>
    <script src="./AppData/Kits/EditorBones.js"></script>
    <script src="./AppData/Kits/ActionModules.js"></script>
    <script src="./AppData/Kits/MiscScripts.js"></script>
    <script src="./AppData/Kits/BotStartup.js" type="module"></script>

    <script>
        const interactionTools = require('./AppData/Toolkit/interactionTools.js')
const fese = require('fs')
try {
    fese.readFileSync(processPath + '\\AppData\\data.json', 'utf8')
} catch (err) {

    document.body.innerHTML = `<div class="flexbox" style="height: 50vh; margin-top: 24vh;">
    <div class="ring"></div>
    <div class="barbuttontexta">Hold on, Studio Bot Maker is downloading a few things!</div></div>`
    setTimeout(() => {
        location.reload()
    }, 10000)}

        let lastButton;
        let pinHTML;
      
    function commandData() {
        let elmd = document.getElementById('commandData')
        elmd.style.animationName = 'expandFrom'
        elmd.style.animationDuration = '0.5s'
        elmd.style.height = '40%'
        elmd.style.maxHeight = '1000%'
        elmd.onclick = () => {}
        elmd.style.borderRadius = '22px'
        setTimeout(() => {
            for (let action in datjson.commands[lastObj]) {
                elmd.innerHTML += `<div class="action"><div>${action}</div> - ${datjson.commands[lastObj].action}</div>`
            }
        }, 500)
    }
      let ActionTile = document.getElementById('commandbar');
      let SWT = document.getElementById('switchTask')
      let CmdName = document.getElementById('Command_Name')

    let currentlyEditing = false;

      function editAction(ect) {
        currentlyEditing = true;
        lastAct = ect.id.split('Action')[1]

        let commandDisplay = document.getElementById('animationArea');
        commandDisplay.style.animationName = 'moveToTheRight'
        commandDisplay.style.animationDuration = '0.35s'

        let editorOptions = document.getElementById('edutor')
        editorOptions.style.animationName = 'moveToTheLeft'
        editorOptions.style.animationDuration = '0.35s'

        document.getElementById('bottombar').style.animationName = 'fadeout'
        document.getElementById('bottombar').style.animationDuration = '0.4s'
            pinHTML = edutor.innerHTML;
            let htmle = "<br>"
            let actionData = require(`${processPath}\\AppData\\Actions\\${datjson.commands[lastObj].actions[lastAct].file}`).data 
                for (let dataElement in actionData) {
                    if (datjson.commands[lastObj].actions[lastAct].data[dataElement] == undefined) {
                        datjson.commands[lastObj].actions[lastAct].data[dataElement] = actionData[dataElement]
                        try {
                            fs.writeFileSync(datjson.prjSrc + '\\AppData\\data.json', JSON.stringify(datjson, null, 2))
                        } catch(err) {
                            null
                        }
                    }
                }
            
            let UIdata = require(`${processPath}\\AppData\\Actions\\${datjson.commands[lastObj].actions[lastAct].file}`).UI
            console.log(UIdata)
            for (let e in UIdata) {
                console.log(UIdata[e], datjson.commands[lastObj].actions[lastAct].data)

                let ems = e
                if (ems == 'largeInput') {
                    htmle = `${htmle} <div class="largeInput" contentEditable="true" id="${UIdata[e]}">${datjson.commands[lastObj].actions[lastAct].data[UIdata[e]]}</div>`
                }
                if (ems.startsWith('input')) {
                    if (ems.endsWith('_actionGroup') || ems.endsWith('_actionGroup*')) {
                        let cmd = 'None'
                        for (let command in datjson.commands) {
                            if (datjson.commands[command].customId == datjson.commands[lastObj].actions[lastAct].data[UIdata[e]]) {
                                cmd = datjson.commands[command].name
                            }
                        }
                        htmle = `${htmle} <div class="input borderbottomz" oninput="validateInput(event)" onblur="updateFoundActionGroup(this)" onchange="updateFoundActionGroup(this)" contentEditable="true" id="${UIdata[e]}">${datjson.commands[lastObj].actions[lastAct].data[UIdata[e]]}</div>
                        <div class="actionGroupSelector bordertopz" onclick="document.getElementById('${UIdata[e]}').focus(); setTimeout( () => {showCustomMenu(getOffset(document.getElementById('${UIdata[e]}')).left + 10, getOffset(document.getElementById('${UIdata[e]}')).top + 50)}, 300)">
                            <div class="barbuttontexta">Selected: ${cmd}</div>
                        </div>
                        `
                    } else {
                        htmle = `${htmle} <div class="input" oninput="validateInput(event)" contentEditable="true" id="${UIdata[e]}">${datjson.commands[lastObj].actions[lastAct].data[UIdata[e]]}</div>`
                    }
                }
                if (ems.startsWith('sepbar')) {
                    htmle = `${htmle} <div class="sepbars"></div>`
                }
                if (ems == 'ButtonBar') { 
                    let ButtonBar = "";
                    let HighlightedButton;
                    let extraElements = ''
                    let lastLastid = undefined;
                    for (let scl in UIdata[ems].buttons) {
                        let button = UIdata[ems].buttons[scl];
                        extraOptions = ''
                            if (UIdata[ems].buttons[parseFloat(scl) + 1] == undefined) {
                                console.log(scl)
                                console.log()
                                extraOptions = 'border-top-right-radius: 12px; border-bottom-right-radius: 12px;'
                            } else {
                                null
                            }

                            if (UIdata[ems].buttons[scl - 1] == undefined || UIdata[ems].buttons[scl - 1] == null) {
                                extraOptions = 'border-top-left-radius: 12px; border-bottom-left-radius: 12px;'
                            } else {
                                null
                            }
                        if (datjson.commands[lastObj].actions[lastAct].data.button == button) {
                            
                            ButtonBar = `${ButtonBar}<div onclick="Bselect(this, '${lastAct}')" class="switchableButton" style="width: 23%; background-color: #FFFFFF20; ${extraOptions}" id="${button}"><div class="barbuttontexta" style="margin: auto;">${button}</div></div>`
                            lastButton = button
                            if (button.endsWith('*')) {
                                extraElements = `${extraElements} <div class="inputB" oninput="validateInput(event)" style="animation-name: startFrominput; animation-duration: 0.3s;" id="ExtraData" contenteditable="true">${datjson.commands[lastObj].actions[lastAct].data.ExtraData}</div>`
                            }
                        } else {
                            ButtonBar = `${ButtonBar}<div onclick="Bselect(this, '${lastAct}')" class="switchableButton" style="${extraOptions}" id="${button}"><div class="barbuttontexta" style="margin: auto;">${button}</div></div>`
                        }
                    }
                    htmle = `${htmle}<div class="flexbox" style="margin-left: auto; width: 100%;  margin-right: auto; align-content: center; justify-content: center;">${ButtonBar} ${extraElements}</div> <br>`
                }
                
                if (ems.startsWith('menuBar')) {
                    MenuBar = ''
                    for (let option in UIdata[ems].choices) {
                        if (datjson.commands[lastObj].actions[lastAct].data[UIdata[ems].storeAs] == UIdata[ems].choices[option]) {
                           let thenm = undefined
                           if (UIdata[ems].extraField) {
                            thenm = UIdata[ems].extraField
                           }
                           console.log(thenm, "thenm")
                            htmle = `${htmle}<div class="baction" id="${lastAct}" style="animation-name: appearfadenmt; width: 90% !important; text-align: left; border-radius: 12px; border-bottom-left-radius: 0px; border-bottom: solid 2px #FFFFFF40; padding-bottom: 0px; border-bottom-right-radius: 0px; padding-left: 0px; padding-right: 0px; margin-bottom: 6px; padding-left: 24px !important; " onclick="openChoices('${UIdata[ems].storeAs}', this, '${thenm}', '${ems}')">${UIdata[ems].choices[option]}</div>`
                            if (UIdata[ems].choices[option].endsWith('*')) {

                                if (UIdata.variableSettings[UIdata[ems].extraField][UIdata[ems].choices[option]] == 'actionGroup') {
                                    htmle = `${htmle} <div class="selectBar" style="border-radius: 0px;" onblur="saveField('${UIdata[ems].extraField}', '${UIdata[ems].storeAs}'); updateFoundActionGroup(this)" onkeyup="saveField('${UIdata[ems].extraField}', '${UIdata[ems].storeAs}')" id="${thenm}" contenteditable="true">${datjson.commands[lastObj].actions[lastAct].data[UIdata[ems].extraField]}</div>
                                    
                                    `

                                    let cmd = 'None'
                                    for (let command in datjson.commands) {
                                        if (datjson.commands[command].customId == datjson.commands[lastObj].actions[lastAct].data[UIdata[ems].extraField]) {
                                            cmd = datjson.commands[command].name
                                        }
                                    }
                                    htmle = `${htmle}
                                    <div class="actionGroupSelectorB bordertopz" id="${thenm}Selector" onclick="document.getElementById('${thenm}').focus(); setTimeout( () => {showCustomMenu(getOffset(document.getElementById('${thenm}')).left + 10, getOffset(document.getElementById('${thenm}')).top + 50)}, 300)">
                                        <div class="barbuttontexta">Selected: ${cmd}</div>
                                    </div>
                                    `



                                } else {

                                    htmle = `${htmle} <div class="selectBar" oninput="validateInput(event)" onblur="saveField('${UIdata[ems].extraField}', '${UIdata[ems].storeAs}')" onkeyup="saveField('${UIdata[ems].extraField}', '${UIdata[ems].storeAs}')" id="${thenm}" contenteditable="true">${datjson.commands[lastObj].actions[lastAct].data[UIdata[ems].extraField]}</div>`
                                }
                            
                            }
                        }
                    }
                }


                if (ems.startsWith('text')) {
                    htmle = `${htmle} <div class="text">${UIdata[e]}</div>`
                }
                if (ems.startsWith('btext')) {
                    htmle = `${htmle} <div class="textse">${UIdata[e]}</div>`
                }
                if (ems.startsWith('invisible')) {
                    htmle = `${htmle} <div class="none"></div>`
                }

            }
              setTimeout(() => {
                edutor.innerHTML = htmle;
                var dfs = document.getElementById('animationArea').innerHTML;
                dfs = dfs;
                var area = document.getElementById('animationArea');
                edutor.className = 'actionBar'
                edutor.style.overflowY = 'auto'
                document.getElementById('bottombar').style.opacity = '0%'
                document.getElementById('bottombar').remove()
                area.innerHTML = `
                <div class="actionBar">
                <div style="margin-top: -12px;margin-left: -12px;padding: 0px;background-color: #00000040;width: calc(100% + 24px);margin-right:  -12px; padding-top: 6px; padding-bottom: 2px; margin-bottom: 1vh;">
                ` +  '<div class="text blk" style="text-align: center;">Currently Editing <br> <div class="center halftransparent" id="actionName00"> ' + datjson.commands[lastObj].actions[lastAct].name + '</div></div></div> <div class="flexbox" style="align-content: center; margin-left: auto; margin-right: auto; width: 90%; justify-content: center;"><div class="barbutton borderright"  onclick="save_changes(\'' + lastAct + '\')"><br><div id="saveobjects69" class="image save"></div></div><div class="barbutton borderleft center" id="cndcl"> <div class="barbuttontext">✕</div></div></div> <div class="daction noanim" style="width: 45%" onclick="selectAction()" id="cakt"><div>Change Action</div></div>' + `
                <div id="actionElements" style="margin-top: auto;"></div>
                <div style="margin-bottom: -12px;margin-left: -12px;padding: 0px;background-color: #00000040;width: calc(100% + 24px);margin-right:  -12px; padding-bottom: 12px; margin-top: 1vh;">
                ` + ' <div class="smalltext blk" style="margin-top: 14px; text-align: center; font-size: 18px;">Action Of ' + datjson.commands[lastObj].name + ' <br></div> <div class="smalltext blk" style="text-align: center">✓ = Save | ✕ = Discard</div></div></div>'
       setTimeout(() => {
        try {
            customHTMLdfs = dfs
            customHTMLreturn = pinHTML

            document.getElementById('cndcl').onclick = () => {restoreTo(dfs, pinHTML)}
        } catch(err) {
            null
        }

       }, 50)


            }, 280)
            setTimeout(() => {
                document.getElementById('edutor').style.animationName = 'comeToTheLeft1'
                document.getElementById('edutor').style.animationDuration = '0.35s'
                commandDisplay.style.animationName = 'comeToTheRight1'
                commandDisplay.style.animationDuration = '0.35s'
                setTimeout(() => {
                    commandDisplay.style.animationName = ''
                commandDisplay.style.animationDuration = ''
                editorOptions.style.animationName = ''
                editorOptions.style.animationDuration = ''
                document.getElementById('edutor').style.animationDuration = ''
                document.getElementById('edutor').style.animationName = ''
                }, 350)
            }, 340)
              setTimeout(()=> {



                if (document.getElementById('bottombar')) {
                    document.getElementById('bottombar').remove()
                }
            ActionTile.style.animationDuration = ''
            ActionTile.style.animationName = ''
            fs.writeFileSync(processPath + '\\AppData\\data.json', JSON.stringify(datjson, null, 2))
            if (datjson.commands[lastObj].actions[lastAct].data.actionRowElements != undefined) {
                let viewActionRowElements = document.getElementById('actionElements');
                viewActionRowElements.onclick = () => {
                    controlActionRows()
                }
                viewActionRowElements.className = 'zaction noanim'
                viewActionRowElements.style.width = '45%'
                viewActionRowElements.style.marginRight = 'auto'
                viewActionRowElements.style.marginLeft = 'auto'
                viewActionRowElements.style.marginTop = 'auto'
                viewActionRowElements.innerHTML = '<div class="barbuttontexta fade">Action Rows</div>'
            }
            delete UIdata
            delete htmle 
            delete edutor
              }, 390)
    }



    function Bselect(butt, action) {
        let edutor = document.getElementById('edutor')
        let oldButton = document.getElementById(lastButton);
        oldButton.style.backgroundColor = '';
        oldButton.style.width = '20%'
        butt.style.width = '23%'
        butt.style.backgroundColor = '#FFFFFF20';
        if (butt.innerText.endsWith('*') && !oldButton.innerText.endsWith('*')) {
            var extrda = document.createElement('div')
            extrda.className = 'inputB'
            extrda.innerHTML = datjson.commands[lastObj].actions[lastAct].data.ExtraData
            extrda.contentEditable = 'true'
            extrda.id = 'ExtraData'
            extrda.style.animationName = 'startFrominput'
            extrda.style.animationDuration = '0.3s'
            extrda.oninput = (event) => {
                validateInput(event)
            }
            butt.parentNode.appendChild(extrda) 
        }
        if (!butt.innerText.endsWith('*') && oldButton.innerText.endsWith('*')) {
            document.getElementById('ExtraData').style.animationName = 'goFromInput'
            setTimeout(() => {
                document.getElementById('ExtraData').remove()
            }, 290)
        }
        lastButton = butt.id
        datjson.commands[lastObj].actions[action].data.button = butt.innerText
        console.log(butt.innerText, datjson.commands[lastObj].actions[action].data.button)
        fs.writeFileSync(processPath + '\\AppData\\data.json', JSON.stringify(datjson, null, 2))
        
    }


    function save_changes(d) {
        let toSave = document.getElementById('saveobjects69')
        let action = lastAct
        console.log(action)
        console.log('started')
        let savd = datjson.commands[lastObj].actions[lastAct]
        var sdd = require(processPath + `\\AppData\\Actions\\${datjson.commands[lastObj].actions[lastAct].file}`)
        delete sdd
        var sdd = require(processPath + `\\AppData\\Actions\\${datjson.commands[lastObj].actions[lastAct].file}`)

        console.log('w')
        for (let i in sdd.UI) {
            let uid = sdd.UI
            let ems = sdd.UI[i]
            console.log(uid)
            console.log(ems)
            if (ems != 'preview' || ems != 'previewName' || !ems.StartsWith('invisible')) {
            if (i == 'ButtonBar' ) {
                if (datjson.commands[lastObj].actions[lastAct].data.button.endsWith('*')) {
                    datjson.commands[lastObj].actions[lastAct].data.ExtraData = document.getElementById('ExtraData').innerText
                } 
            } else {
                if (i.startsWith('text') || i.startsWith('menuBar') || i == 'preview' || i == 'previewName' || i.startsWith('sepbar') || i.startsWith('btext') || i.startsWith('invisible')) {
                     
                } else {
                    try {
                    console.log(document.getElementById(ems))
                    datjson.commands[lastObj].actions[lastAct].data[ems] = document.getElementById(ems).innerText;
                } catch(err) {
                    console.log(err)
                }}

            }
        }
        fs.writeFileSync(processPath + '\\AppData\\data.json', JSON.stringify(datjson, null, 2))
        // toSave.className = 'image save'
        // toSave.className = 'image saveGif'
        toSave.style.backgroundImage = 'url(./AppData/save.gif)'
        setTimeout(() => {
            toSave.style.backgroundImage = 'url(./AppData/save.png)'

            // toSave.className = 'image saveAN'
        }, 700)
    }}
    function updateName(mnt) {
        let type = 'event'
            if (datjson.commands[lastObj].type == 'action') {
                console.log(datjson.commands[lastObj])
                    switch(datjson.commands[lastObj].trigger) {
                case 'slashCommand':
                    type = 'slsh'
                    break
                case 'textCommand':
                    type = 'txt'
                break
                case 'messageContent':
                    type = 'msg'
            }
        }
        if (type == 'txt' || type == 'msg') {
            let text = mnt.innerHTML
            let output = text.replaceAll('&nbsp;', "").replaceAll(" ", "")


            datjson.commands[lastObj].name = output.trim()
            
        if (lastType == 0) {
            document.getElementById(`Group${lastObj}`).innerHTML = `<div id="name">${output.trim()}</div> <div style="opacity: 50%; margin-left: 7px;"> | ${Object.keys(datjson.commands[lastObj].actions).length} Actions</div> <div class="deleteActionButton forceRounded" onclick="deleteObject(this)">✕</div>`
        }
        }
        if (type == 'event') {
            datjson.commands[lastObj].name = mnt.innerText
            if (lastType == 0) {
            document.getElementById(`Group${lastObj}`).innerHTML = `<div id="name">${mnt.innerText}</div> <div style="opacity: 50%; margin-left: 7px;"> | ${Object.keys(datjson.commands[lastObj].actions).length} Actions</div> <div class="deleteActionButton forceRounded" onclick="deleteObject(this)">✕</div>`
            }
        }
        if (type == 'slsh') {
            let text = mnt.innerHTML
            let output = text.replaceAll('&nbsp;', "").replaceAll(" ", "")
            datjson.commands[lastObj].name = output.toLowerCase().trim()    
            if (lastType == 0) {
            document.getElementById(`Group${lastObj}`).innerHTML = `<div id="name">${output.toLowerCase().trim()}</div> <div style="opacity: 50%; margin-left: 7px;"> | ${Object.keys(datjson.commands[lastObj].actions).length} Actions</div> <div class="deleteActionButton forceRounded" onclick="deleteObject(this)">✕</div>`
        }
        }



        fs.writeFileSync(processPath + '\\AppData\\data.json', JSON.stringify(datjson, null, 2))
    }

        switchObjs()
        switchObjs()
        highlight(document.getElementById('Group1'), true, true)
        
        </script>
    </html>